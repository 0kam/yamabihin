# 3. レコーダー管理アプリ
備品管理アプリと連携して、山に設置されている音声レコーダーの管理と交換スケジュールを把握するためのアプリです。

## 概要
山岳班では、自動録音の音声レコーダーを山に設置し、鳥類の鳴き声等の観測を行っています。レコーダーは電池とSDカードの交換が頻繁に必要ですが、その頻度は機種やバッテリーの種類、録音スケジュールによって異なります。

レコーダー管理アプリは、以下の機能を提供します：
- 各レコーダーの基本情報管理（設置場所、状態等）
- 録音スケジュールの管理（録音時間帯、録音間隔等）
- 電池・SDカードの交換スケジュール管理
- 電池・SDカードの交換時期が近づいた際の通知機能

## データベース
以下の3つのDBを持ち、相互に関連付けられるようにします。

1. recorders
recorder_id, bihin_id, location, lon, lat, area_id, installation_date, recording_schedule, status, manager, manager_email, who_wrote_this, when_wrote_this, installation_image_paths

2. recorder_schedules
schedule_id, recorder_id, battery_type, battery_voltage, battery_capacity, daily_power_usage, last_battery_change, next_battery_change, storage_capacity, daily_storage_usage, last_storage_change, next_storage_change, notification_sent, who_wrote_this, when_wrote_this

3. recorder_maintenances
maintenance_id, recorder_id, maintenance_date, maintenance_type, description, performed_by, who_wrote_this, when_wrote_this

## UI
### レコーダー一覧
トップページはレコーダーのリストを表形式で表示します。表の並び順はデフォルトでエリア別とし、状態や次回交換日でも並び替えられるようにします。
- エリアによるフィルタリング機能
- レコーダーの状態（稼働中、メンテナンス中、故障中等）によるフィルタリング機能
- 次回交換（電池・SDカード）が近いものを強調表示、「要交換!」などの表示

### レコーダー登録
新しいレコーダーを登録するための画面です。
- 備品の選択（備品管理アプリのデータから選択）
- エリア（選択式、備品管理アプリと共通）
- 設置場所名称（自由入力）
- 緯度・経度（地理院地図からピンで選択。以下のiframeが利用可能）
    ```
    <iframe frameborder="0" scrolling="no" marginheight="0" marginwidth="0" width="500" height="400" src="https://maps.gsi.go.jp/?hc=hic#6/38.453589/140.493164/&base=std&ls=std&disp=1&vs=c1g1j0h0k0l0u0t0z0r0s0m0f1"></iframe>
    ```
- 設置日（カレンダーから選択）
- 録音スケジュール設定
  - 開始時間・終了時間（時間選択）
  - 録音間隔（オン・オフの時間をそれぞれ分単位で入力）
  - サンプリングレート（数字入力、Hz）
  - チャンネル数（選択式、モノラル、ステレオ、4ch, 8ch）
- 状態（選択式：稼働中、メンテナンス中、故障中、撤去済み）
- 管理者（自由入力）
- 管理者メールアドレス
- 設置状況写真（複数選択枚可能、任意）

### レコーダー詳細
各レコーダーの詳細情報を表示します。
- 基本情報（ID、設置場所、エリア、設置日等）
- 録音スケジュール情報
- 電池・SDカード交換スケジュール
- メンテナンス履歴
- 編集・削除ボタン

### 交換スケジュール設定
レコーダーの電池・SDカード交換スケジュールを設定するための画面です。

**バッテリー設定：**
- バッテリータイプ（選択式：単三、単一、12V充電池（鉛蓄電池等）、5V充電池（モバイルバッテリー等）、その他）
- バッテリー電圧（V単位で入力）
- バッテリー容量（mAh単位で入力、mWhに自動変換して表示）
- 1日あたりの電力消費（mWh単位で入力）
- 最終バッテリー交換日（カレンダーから選択）
- 次回バッテリー交換予定（自動計算で表示。安全率0.8をかける。）

**ストレージ設定：**
- ストレージ容量（GB単位で入力）
- 1日あたりのストレージ消費（MB単位で入力）
- 最終ストレージ交換日（カレンダーから選択）
- 次回ストレージ交換予定（自動計算で表示）

### メンテナンス管理
レコーダーのメンテナンス履歴を記録・管理するための画面です。
- メンテナンス日（カレンダーから選択）
- メンテナンスタイプ（選択式：バッテリー交換、SDカード交換、修理、その他）
- 説明（自由入力）
- 実施者（自由入力）

## 連携機能
備品管理アプリとの連携により、以下の機能を実現します：
1. レコーダーとして備品を選択する際、備品管理アプリのデータを参照
2. 電池・SDカードの交換で備品の移動があった場合、自動的に備品管理アプリの移動履歴に反映
3. メンテナンス履歴と備品の移動履歴を相互に参照可能

## 通知機能
交換時期が近づいたレコーダーに対して、以下の通知機能を提供します：
1. アプリ上での視覚的な通知（色による強調表示、アイコン表示等）
2. 交換予定日の7日前と3日前に管理者へのメール通知
3. 交換期限を過ぎた場合の警告通知